<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiring_Job Offer to Work Handover 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        #entranceAnimationOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        #entranceAnimationOverlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(79, 70, 229, 0.3);
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            margin-top: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            animation: fadeInOut 2s infinite ease-in-out;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @keyframes modalPopup {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            60% {
                transform: scale(1.05);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        .modal-content.modal-popup-active {
            animation: modalPopup 0.4s ease-out forwards;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }
        .modal-content-wrapper {
            /* Wrapper can be used for additional styling if needed, but centering is on .modal */
        }
        .modal-content {
            background-color: #ffffff;
            padding: 1rem;
            border: 1px solid #d1d5db;
            width: 90%; /* Fallback for very small screens */
            max-width: 95vw; /* Ensure it doesn't exceed viewport width on very small screens */
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            position: relative;
            transform: scale(1);
            opacity: 1;
            max-height: calc(90vh - 1rem);
            overflow-y: auto;
        }

        @media (min-width: 500px) {
            .modal-content {
                width: 75vw;
            }
        }

        #addEntrySectionModal .modal-content,
        #howToUseModal .modal-content,
        #doerInfoModal .modal-content {
            max-width: 850px;
        }
        #entryDetailsModal .modal-content {
            max-width: 1000px;
        }
        #messageAlertModal .modal-content {
            width: auto;
            max-width: 450px;
        }

        @media (min-width: 640px) {
            .modal-content {
                padding: 1.5rem;
                max-height: calc(90vh - 3rem);
            }
            #messageAlertModal .modal-content {
                padding: 1.5rem;
            }
        }
        @media (min-width: 768px) {
             .modal-content {
                padding: 25px;
            }
        }


        #addEntrySectionModal .modal-content {
             padding: 5px;
        }
        #googleFormIframe {
            width: 100%;
            height: calc(85vh - 70px);
            border: none;
        }

        .close-button {
            color: #6b7280; position: absolute; top: 0.5rem; right: 0.75rem;
            font-size: 1.875rem; font-weight: bold; transition: color 0.2s;
            line-height: 1;
            z-index: 10;
            padding: 0.25rem;
        }
         @media (min-width: 640px) {
            .close-button {
                top: 10px; right: 15px;
            }
        }

        .modal-controls-group {
            position: absolute;
            top: 0.5rem; right: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            z-index: 10;
        }
        @media (min-width: 640px) {
            .modal-controls-group {
                top: 12px; right: 15px;
                gap: 6px;
            }
        }

        .modal-control-button {
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
        .modal-control-button svg {
            width: 1rem;
            height: 1rem;
            display: block;
        }
        .modal-control-button.delete-btn svg { fill: #9ca3af; }
        .modal-control-button.delete-btn:hover svg { fill: #dc2626; }
        .modal-control-button.close-btn svg { fill: #9ca3af; }
        .modal-control-button.close-btn:hover svg { fill: #374151; }
         .modal-control-button.close-lost-btn svg { fill: #9ca3af; }
        .modal-control-button.close-lost-btn:hover svg { fill: #f97316; }
        .modal-control-button:hover { background-color: #e5e7eb; }
        .modal-control-button.sync-btn svg { fill: #9ca3af; }
        .modal-control-button.sync-btn:hover svg { fill: #4f46e5; }


        .table-container::-webkit-scrollbar { width: 8px; height: 8px; }
        .table-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .table-container::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .table-container::-webkit-scrollbar-thumb:hover { background: #555; }
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.375rem; font-weight: 500;
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, transform 0.1s ease;
            cursor: pointer; text-align: center; display: inline-flex;
            align-items: center; justify-content: center;
            min-height: 44px;
        }
        @media (min-width: 640px) {
            .btn {
                padding: 0.75rem 1.5rem;
            }
        }
        .btn svg { margin-right: 0.5rem; margin-left: -0.25rem; }
        .btn-icon-only svg { margin-right: 0; margin-left: 0; }
        .btn:active { transform: translateY(1px); }
        .btn-primary { background-color: #4f46e5; color: white; }
        .btn-primary:hover { background-color: #4338ca; box-shadow: 0 4px 14px 0 rgba(79,70,229,0.39); }
        .btn-secondary { background-color: #e5e7eb; color: #374151; }
        .btn-secondary:hover { background-color: #d1d5db; }
        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; }
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-warning:hover { background-color: #d97706; }
        .btn-info { background-color: #3b82f6; color: white; }
        .btn-info:hover { background-color: #2563eb; }
        .btn-danger { background-color: #dc2626; color: white; }
        .btn-danger:hover { background-color: #b91c1c; }

        .form-grid { display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; }
        @media (min-width: 768px) {
            .form-grid { grid-template-columns: repeat(2, 1fr); gap: 1.25rem; }
            .form-grid .col-span-2 { grid-column: span 2 / span 2; }
        }

        .delay-ontime { color: #10b981; font-weight: 500; }
        .delay-late { color: #dc2626; font-weight: 500; }
        .delay-early { color: #3b82f6; font-weight: 500; }
        .overdue-task { color: #dc2626; font-weight: bold; }

        #entryDetailsModal .crm-card { background: #fff; }
        #entryDetailsModal .crm-card h2 { margin-bottom: 1rem; font-size: 1.125rem; sm:font-size: 1.25rem; color: #2c3e50; font-weight: 600; }
        #entryDetailsModal .crm-section-row { display: flex; flex-direction: column; sm:flex-row; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
        #entryDetailsModal .crm-section { flex: 1 1 100%; sm:flex: 1 1 300px; border-radius: 8px; border: 1px solid #e0e0e0; background-color: var(--section-bg, rgba(200,200,200,0.1)); font-size: 0.8rem; sm:font-size: 13px; min-width: 280px; }
        #entryDetailsModal .crm-section-header { padding: 0.5rem 0.75rem; sm:padding: 8px 12px; font-weight: 700; font-size: 0.875rem; sm:font-size: 14px; display: flex; align-items: center; gap: 0.5rem; sm:gap: 8px; color: white; background-color: var(--section-color, #777); border-top-left-radius: 7px; border-top-right-radius: 7px;}
        #entryDetailsModal .crm-section-header svg { width: 0.875rem; height: 0.875rem; sm:width: 16px; sm:height: 16px; fill: white;}
        #entryDetailsModal .crm-section-content { padding: 0.625rem 0.75rem; sm:padding: 10px 12px; border-bottom-left-radius: 7px; border-bottom-right-radius: 7px;}
        #entryDetailsModal .crm-description-item { margin-bottom: 0.5rem; }
        #entryDetailsModal .crm-description-item:last-child { margin-bottom: 0; }
        #entryDetailsModal .crm-label { font-weight: 600; color: #555; font-size: 0.75rem; sm:font-size: 0.8rem; margin-bottom: 2px;}
        #entryDetailsModal .crm-value { font-size: 0.8rem; sm:font-size: 0.9rem; color: #222; word-break: break-word;}
        #entryDetailsModal .crm-status-banner { background-color: #fff3cd; color: #856404; padding: 0.625rem 0.75rem; sm:padding: 10px 12px; border-radius: 8px; font-weight: 700; text-align: center; margin-top: 1.25rem; font-size: 0.875rem; sm:font-size: 14px;}

        .details-section { background-color: #f9fafb; padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;}
        .details-section h3 { font-size: 1rem; sm:font-size: 1.125rem; font-weight: 600; color: #4f46e5; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid #6366f1; }
        .timeline-step { padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-bottom: 0.75rem; background-color: #fff;}
        .timeline-step strong { color: #4338ca; font-size: 0.9rem; sm:font-size: 1rem; display: block; margin-bottom: 0.25rem;}
        .timeline-details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); sm:grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;}
        .timeline-details-grid .details-item { padding: 0.1rem 0; margin-bottom: 0.1rem;}
        .timeline-details-grid .details-label { font-size: 0.75rem; sm:font-size: 0.8rem; }
        .timeline-details-grid .details-value { font-size: 0.8rem; sm:font-size: 0.85rem; }
        .timeline-step .btn-take-action { margin-top: 0.75rem; padding: 0.375rem 0.75rem; font-size: 0.875rem; }
        .timeline-step .action-button-group { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; }

        /* Removed sortable-header CSS rules */

        .scorecard-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); sm:grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.5rem; sm:gap: 1rem; margin-bottom: 1.5rem; sm:margin-bottom: 2rem;}
        .scorecard { background-color: white; padding: 1rem; sm:padding: 1.25rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); text-align: center;}
        .scorecard-title { font-size: 0.75rem; sm:font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem; sm:margin-bottom: 0.5rem; font-weight: 500; }
        .scorecard-value { font-size: 1.875rem; sm:font-size: 2.25rem; font-weight: 700; color: #1f2937; }
        .scorecard.total-candidates .scorecard-value { color: #4f46e5; }
        .scorecard.pending-acceptance .scorecard-value { color: #f59e0b; }
        .scorecard.pending-onboarding .scorecard-value { color: #84cc16; }
        .scorecard.pending-kit-handover .scorecard-value { color: #3b82f6; }
        .scorecard.pending-training .scorecard-value { color: #a855f7; }
        .scorecard.pending-role-handover .scorecard-value { color: #ec4899; }
        .scorecard.process-completed .scorecard-value { color: #10b981; }


        /* Status Badge Styles for Hiring FMS 2.0 */
        .status-badge {
            padding: 0.25em 0.6em;
            border-radius: 0.25rem;
            font-size: 0.7rem;
            sm:font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            display: inline-block;
            min-width: 100px;
            sm:min-width: 120px;
            color: white;
        }
        .status-pending-acceptance { background-color: #fbbf24; color: #78350f; }
        .status-pending-onboarding { background-color: #a3e635; color: #3f6212; }
        .status-pending-kit-handover { background-color: #60a5fa; color: #1e3a8a; }
        .status-pending-training { background-color: #c084fc; color: #581c87; }
        .status-pending-role-handover { background-color: #f472b6; color: #831843; }
        .status-process-completed { background-color: #34d399; color: #065f46; }
        .status-default { background-color: #9ca3af; color: white; }


        /* Class for rotating sync icon */
        .rotate-animate {
            animation: rotateIcon 1s linear;
        }
        @keyframes rotateIcon {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        .main-content-area {
            flex-grow: 1;
            padding: 0.75rem;
        }
         @media (min-width: 640px) {
            .main-content-area {
                padding: 1.5rem;
            }
        }
        @media (min-width: 768px) {
            .main-content-area {
                padding: 2rem;
            }
        }


        @media screen and (max-width: 768px) {
            .responsive-table thead { display: none; }
            .responsive-table tr { display: block; margin-bottom: 0.625em; border-radius: 0.375rem; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); border: 1px solid #e5e7eb;}
            .responsive-table td {
                display: block; text-align: right; font-size: 0.75rem;
                border-bottom: 1px solid #e5e7eb; padding: 0.4rem 0.6rem !important;
                padding-left: 42% !important;
                position: relative;
            }
            .responsive-table td::before {
                content: attr(data-label); position: absolute; left: 0.4rem;
                width: 38%;
                padding-right: 0.4rem;
                white-space: nowrap; text-align: left; font-weight: 600; color: #4b5563;
            }
            .responsive-table td:last-child { border-bottom: 0; }
            .responsive-table.doer-info-table td { padding-left: 30% !important; }
            .responsive-table.doer-info-table td::before { width: 25%; }
            .main-action-buttons button { width: 100%; margin-bottom: 0.5rem;}
        }
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem; /* space-x-2 and space-y-2 equivalent */
            align-items: center;
        }
        .filter-item {
            flex-grow: 1; /* Allow items to grow */
            min-width: 150px; /* Minimum width for filter items */
        }
         @media (min-width: 1024px) { /* lg breakpoint */
            .filter-container {
                flex-wrap: nowrap; /* Prevent wrapping on larger screens */
            }
            #searchInputContainer {
                flex-shrink: 0; /* Prevent search input from shrinking too much */
                width: auto;
            }
            #filterControlsContainer {
                 flex-grow: 1;
                 display: flex;
                 flex-wrap: wrap; /* Allow filters to wrap within their container */
                 gap: 0.5rem;
                 justify-content: flex-end;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-lg font-bold text-gray-800">Onboarding FMS</p>
                    </div>
                </div>

                <div class="flex items-center space-x-2 sm:space-x-4">
                    <nav id="mainNav" class="flex space-x-1 sm:space-x-2 md:space-x-4 mr-2 sm:mr-4">
                        <a href="index.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Home</a>
                        <a href="Account.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Account</a>
                        <a href="Billing.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Billing</a>
                        <a href="Hiring.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Hiring</a>
                        <a href="Onboarding.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Onboarding</a>
                        <a href="Offboarding.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Offboarding</a>
                        <a href="Salary.html" class="nav-link px-2 py-1 text-sm sm:text-base text-gray-700 hover:text-indigo-600 font-medium rounded-md">Salary</a>
                    </nav>


                    <div class="hidden sm:block">
                        <p id="dateTimeDisplay" class="text-xs text-gray-500"></p>
                    </div>
                    <button id="syncButton" type="button" title="Sync Data" class="p-1.5 rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                        <span class="sr-only">Sync Data</span>
                        <svg class="h-5 w-5 sm:h-6 sm:w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>
                    </button>
                    <button id="userProfileButton" type="button" title="User Profile" class="p-1.5 rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                        <span class="sr-only">Open user menu</span>
                        <svg class="h-5 w-5 sm:h-6 sm:w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div id="entranceAnimationOverlay">
        <div class="spinner"></div>
        <p class="loading-text">Loading Hiring_Job Offer to Work Handover 2.0...</p>
    </div>

    <div class="main-content-area container mx-auto max-w-7xl bg-white rounded-lg shadow-xl mt-4">
        <div class="mb-4 sm:mb-6 flex flex-col sm:flex-row sm:flex-wrap justify-end gap-2 main-action-buttons">
            <button id="openDoerInfoModalButton" class="btn btn-secondary text-sm w-full sm:w-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                    <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                </svg>
                Responsibilities
            </button>
            <button id="openBackendDataButton" class="btn btn-secondary text-sm w-full sm:w-auto">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-database-fill-gear" viewBox="0 0 16 16">
                    <path d="M8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1"/>
                    <path d="M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .021-.001.043-.003.064C13.486 7.153 12.006 7.5 8 7.5s-5.486-.347-6.997-.436A1.02 1.02 0 0 1 2 7m-1 7v-1c0-.021.001-.043.003-.064C1.514 12.847 2.994 12.5 6 12.5s4.486.347 5.997.436c.002.02.003.043.003.064v1a1.02 1.02 0 0 1-.003.064C11.486 13.153 10.006 13.5 7 13.5s-4.486-.347-5.997-.436A1.02 1.02 0 0 1 1 14m10.887-1.754C10.51 12.089 9.36 12 8 12s-2.51.089-3.887.246a.5.5 0 0 0-.113.034V10.5a.5.5 0 0 1 .113-.034C5.49 10.32 6.64 10.25 8 10.25s2.51.07 3.887.216a.5.5 0 0 1 .113.034v1.716a.5.5 0 0 0-.113-.034M15.777 11.1l-.82-.072A1.8 1.8 0 0 0 14.19 11H14v-.11c0-.081-.001-.16-.004-.238c-.103-.64-.393-1.22-.788-1.73A2.99 2.99 0 0 0 11.437 8c-.152.243-.29.505-.412.786A2.99 2.99 0 0 0 12.563 8c.152.243.29.505.412.786a2.99 2.99 0 0 0 1.025.974c.003.078.004.157.004.238V11h-.191c-.391-.03-.755-.166-1.058-.28A1.8 1.8 0 0 0 11.4 11.1l-.82.072a.5.5 0 1 0 .036.993l.82-.072c.14-.012.274-.003.393.047a.5.5 0 0 0 .253.286l.708.404a.5.5 0 0 0 .596-.044l.708-.404a.5.5 0 0 0 .253-.286c.118-.05.253-.059.393-.047l.82.072a.5.5 0 1 0 .036-.993zM8 16a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                </svg>
                Backend Data
            </button>
            <button id="openHowToUseModalButton" class="btn btn-secondary text-sm w-full sm:w-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle-fill" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c-.584 0-1.009-.394-1.009-.927 0-.552.425-.94 1.01-.94.609 0 1.028.388 1.028.94 0 .533-.42.927-1.029.927z"/>
                </svg>
                How to Use
            </button>
            <button id="openEntryFormModalButton" class="btn btn-primary text-sm w-full sm:w-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/></svg>
                Add Entry
            </button>
        </div>

        <section id="scorecardSection" class="mb-6 sm:mb-8">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-3 sm:mb-4">Overview Scorecards</h2>
            <div class="scorecard-container">
                <div class="scorecard total-candidates"> <div class="scorecard-title">Total Candidates</div>
                    <div class="scorecard-value" id="scorecardTotalCandidates">0</div>
                </div>
                <div class="scorecard pending-acceptance"> <div class="scorecard-title">Pending Acceptance & Contract</div>
                    <div class="scorecard-value" id="scorecardPendingAcceptance">0</div>
                </div>
                <div class="scorecard pending-onboarding"> <div class="scorecard-title">Pending Onboarding</div>
                    <div class="scorecard-value" id="scorecardPendingOnboarding">0</div>
                </div>
                <div class="scorecard pending-kit-handover"> <div class="scorecard-title">Pending Kit Handover</div>
                    <div class="scorecard-value" id="scorecardPendingKitHandover">0</div>
                </div>
                 <div class="scorecard pending-training"> <div class="scorecard-title">Pending Training</div>
                    <div class="scorecard-value" id="scorecardPendingTraining">0</div>
                </div>
                <div class="scorecard pending-role-handover"> <div class="scorecard-title">Pending Role Handover</div>
                    <div class="scorecard-value" id="scorecardPendingRoleHandover">0</div>
                </div>
                 <div class="scorecard process-completed"> <div class="scorecard-title">Process Completed</div>
                    <div class="scorecard-value" id="scorecardProcessCompleted">0</div>
                </div>
            </div>
        </section>


        <div id="addEntrySectionModal" class="modal"><div class="modal-content-wrapper">
            <section class="modal-content bg-gray-50">
                <span id="closeEntryFormModalButton" class="close-button">&times;</span>
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-2 text-center">Add New Hiring Entry</h2>
                <p class="text-xs sm:text-sm text-gray-500 text-center mb-3 sm:mb-4">Please submit new entries using the Google Form.</p>
                <iframe id="googleFormIframe"
                        src="https://docs.google.com/forms/d/e/1FAIpQLSc9Na1QZsDukXu0hkn3P70UzXRkMPdZtHe14Bsgq2sSU-sEKQ/viewform?embedded=true"
                        frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
            </section>
        </div></div>

        <div id="doerInfoModal" class="modal"><div class="modal-content-wrapper">
            <section class="modal-content bg-white">
                <span id="closeDoerInfoModalButton" class="close-button">&times;</span>
                <h1 class="text-xl sm:text-2xl font-bold text-indigo-600 mb-4 sm:mb-6">Hiring Process Responsibilities</h1>
                <div class="space-y-4 sm:space-y-6 text-gray-700 text-xs sm:text-sm leading-relaxed">
                    <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                            <svg class="h-5 w-5 sm:h-6 sm:w-6 text-blue-500 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                            Add Entry: Candidate Details
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HR Team / Recruiter</li>
                            <li><strong>How:</strong> Click on "Add Entry" button (opens Google Form)</li>
                            <li><strong>When:</strong> As new candidates are identified</li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                            <svg class="h-5 w-5 sm:h-6 sm:w-6 text-purple-500 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                            </svg>
                            Stage 1: Acceptance & Contract Signing
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HR</li>
                            <li><strong>How:</strong> Email/Whats app/Call (or via external link in FMS)</li>
                            <li><strong>When:</strong> Within two days of Add Entry</li>
                        </ul>
                    </div>
                     <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                            <svg class="h-5 w-5 sm:h-6 sm:w-6 text-orange-400 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                            </svg>
                            Stage 2: Onboarding & Documentation
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HR</li>
                            <li><strong>How:</strong> On Joining Day (or via external link in FMS)</li>
                            <li><strong>When:</strong> Within one day of Acceptance & Contract Signing</li>
                        </ul>
                    </div>
                     <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                            <svg class="h-5 w-5 sm:h-6 sm:w-6 text-yellow-500 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.839 2.51l-4.66-2.51m0 0l-1.023-.55a2.25 2.25 0 00-2.134 0l-1.023.55m0 0l-4.661 2.509m5.684-9.342L12 15.382l2.816-1.21M12 15.382L12 21m0-5.618v5.618m0 0L12 15.382m0 0l2.816-1.21m-5.632 0L12 15.382" />
                            </svg>
                            Stage 3: Introduction & Employee Kit Handover
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HR</li>
                            <li><strong>How:</strong> Face to Face (or via external link in FMS)</li>
                            <li><strong>When:</strong> Within one day of Onboarding & Documentation</li>
                        </ul>
                    </div>
                     <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                            <svg class="h-5 w-5 sm:h-6 sm:w-6 text-teal-500 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                            </svg>
                            Stage 4: Training & Introduction
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HOD</li>
                            <li><strong>How:</strong> Face to Face (or via external link in FMS)</li>
                            <li><strong>When:</strong> Within two days of Onboarding & Documentation</li>
                        </ul>
                    </div>
                     <div class="bg-gray-50 p-3 sm:p-4 rounded-md shadow">
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mb-2 flex items-center">
                             <svg class="h-5 w-5 sm:h-6 sm:w-6 text-pink-500 mr-2 sm:mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-1.621-1.621A3 3 0 0113.5 18.257V17.25m6-3V3.75A2.25 2.25 0 0017.25 1.5H6.75A2.25 2.25 0 004.5 3.75v10.5a2.25 2.25 0 002.25 2.25h10.5a2.25 2.25 0 002.25-2.25z" />
                            </svg>
                            Stage 5: Role & Work Handover
                        </h2>
                        <ul class="list-disc list-inside ml-6 sm:ml-10 space-y-1">
                            <li><strong>Who:</strong> HOD</li>
                            <li><strong>How:</strong> Face to Face (or via external link in FMS)</li>
                            <li><strong>When:</strong> Within one day of Onboarding & Documentation</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-6 sm:mt-8 text-right">
                    <button type="button" id="okDoerInfoModalButton" class="btn btn-primary">OK</button>
                </div>
            </section>
        </div></div>

        <div id="entryDetailsModal" class="modal"><div class="modal-content-wrapper">
            <section class="modal-content bg-white">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-1 mt-6 sm:mt-8" id="detailsModalTitle">Entry Details</h2>
                <p class="text-xs sm:text-sm text-gray-500 mb-4 sm:mb-6" id="detailsModalSubtitle"></p>
                <div id="detailsModalContent">
                    </div>
            </section>
        </div></div>

        <div id="howToUseModal" class="modal"><div class="modal-content-wrapper">
            <section class="modal-content bg-white">
                <span id="closeHowToUseModalButton" class="close-button">&times;</span>
                <h1 class="text-xl sm:text-2xl font-bold text-indigo-600 mb-4">How to Use Hiring FMS 2.0</h1>
                <div class="space-y-3 sm:space-y-4 text-gray-700 text-xs sm:text-sm leading-relaxed">
                    <p>Welcome to the <strong>Hiring_Job Offer to Work Handover 2.0 FMS</strong>. This guide outlines how to use the system for managing candidate progress.</p>
                    <div>
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mt-2 sm:mt-3 mb-1">1. Adding a New Candidate Entry</h2>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Click the <strong class="text-indigo-600">"Add Entry"</strong> button. This will open the Google Form for "Candidate Details" in a new tab.</li>
                            <li>Fill in the Google Form and submit it. This is typically done by the HR Team or Recruiter.</li>
                            <li>New entries appear in the FMS table after the next data sync (click 🔄).</li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mt-2 sm:mt-3 mb-1">2. Viewing and Managing Entries</h2>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>All candidates are listed in the main table with their current status.</li>
                            <li>Use the <strong>search bar</strong> to find specific candidates.</li>
                            <li>Click the <span class="inline-flex items-center justify-center h-5 w-5 bg-blue-100 text-blue-600 rounded-full align-middle">👁️</span> icon for detailed information and to take actions.</li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mt-2 sm:mt-3 mb-1">3. Processing Entries Through Hiring Stages</h2>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Open <strong>Entry Details</strong> for a candidate. The "Stage Processing" section shows the hiring pipeline.</li>
                            <li><strong>Stage 1: Acceptance & Contract Signing:</strong>
                                <ul class="list-circle list-inside ml-5 space-y-1">
                                    <li>If status is "Pending: Acceptance & Contract Signing", a "Take Action" button is available.</li>
                                    <li>This may open an external form/link (if specified in `Take Action (Acceptance & Contract singning)` field) or allow internal status update.</li>
                                    <li>Once completed, status moves to "Pending: Onboarding & Documentation".</li>
                                </ul>
                            </li>
                            <li><strong>Stage 2: Onboarding & Documentation:</strong>
                                <ul class="list-circle list-inside ml-5 space-y-1">
                                    <li>If status is "Pending: Onboarding & Documentation", click "Take Action".</li>
                                    <li>Complete task as per "How" in Responsibilities (On Joining Day).</li>
                                    <li>Status moves to "Pending: Introduction & Employee Kit Handover".</li>
                                </ul>
                            </li>
                             <li><strong>Stage 3: Introduction & Employee Kit Handover:</strong>
                                <ul class="list-circle list-inside ml-5 space-y-1">
                                    <li>If status is "Pending: Introduction & Employee Kit Handover", click "Take Action".</li>
                                    <li>Complete task (Face to Face).</li>
                                    <li>Status moves to "Pending: Training & Introduction".</li>
                                </ul>
                            </li>
                             <li><strong>Stage 4: Training & Introduction:</strong>
                                <ul class="list-circle list-inside ml-5 space-y-1">
                                    <li>If status is "Pending: Training & Introduction", click "Take Action".</li>
                                    <li>Complete task (Face to Face).</li>
                                    <li>Status moves to "Pending: Role & Work Handover".</li>
                                </ul>
                            </li>
                             <li><strong>Stage 5: Role & Work Handover:</strong>
                                <ul class="list-circle list-inside ml-5 space-y-1">
                                    <li>If status is "Pending: Role & Work Handover", click "Take Action".</li>
                                    <li>Complete task (Face to Face).</li>
                                    <li>Status moves to "Process Completed".</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mt-2 sm:mt-3 mb-1">4. Task Responsibilities</h2> <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Click the <strong>“Responsibilities”</strong> button to view details on who performs each stage, how, and when.</li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-md sm:text-lg font-semibold text-indigo-500 mt-2 sm:mt-3 mb-1">5. Syncing Data</h2> <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Click the <strong>🔄 Sync icon</strong> in the top header to refresh and load the latest data from the Google Sheet.</li>
                        </ul>
                    </div>

                    <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-green-50 border-l-4 border-green-500 text-green-700 rounded-md">
                        <p class="font-bold">🔧 Note:</p>
                        <p>This guide is for <strong>Hiring_Job Offer to Work Handover 2.0 FMS</strong>. For issues, contact the <strong>Admin/Support</strong>.</p>
                    </div>
                </div>
                <div class="mt-4 sm:mt-6 text-right">
                    <button type="button" id="okHowToUseModalButton" class="btn btn-primary">OK</button>
                </div>
            </section>
        </div></div>

        <section id="entriesListSection" class="mb-6 sm:mb-10">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-4 sm:mb-6">All Candidate Entries</h2>
            <div class="flex flex-col md:flex-row justify-between items-center mb-3 sm:mb-4 space-y-3 md:space-y-0 md:space-x-4">
                <div id="searchInputContainer" class="w-full md:w-auto md:flex-shrink-0">
                    <input type="text" id="searchInput" placeholder="Search entries..." class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm">
                </div>
                <div id="filterControlsContainer" class="w-full md:w-auto flex flex-col sm:flex-row sm:flex-wrap gap-2 items-center md:justify-end">
                    <div class="filter-item w-full sm:w-auto">
                        <select id="statusFilter" class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm">
                            <option value="">All Statuses</option>
                        </select>
                    </div>
                    <div class="filter-item w-full sm:w-auto">
                        <input type="date" id="dateStartFilter" class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm" placeholder="Start Date">
                    </div>
                    <div class="filter-item w-full sm:w-auto">
                        <input type="date" id="dateEndFilter" class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm" placeholder="End Date">
                    </div>
                    <div class="filter-item w-full sm:w-auto">
                        <select id="designationFilter" class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm">
                            <option value="">All Designations</option>
                        </select>
                    </div>
                    <div class="filter-item w-full sm:w-auto">
                        <select id="actionStatusFilter" class="p-2 border border-gray-300 rounded-md shadow-sm w-full text-sm">
                            <option value="">All Actions</option>
                            <option value="overdue">Overdue Actions</option>
                            <option value="upcoming">Upcoming Actions (Next 7 Days)</option>
                        </select>
                    </div>
                     <button id="clearFiltersButton" class="btn btn-warning text-sm p-2 w-full sm:w-auto">Clear Filters</button>
                </div>
            </div>
            <div id="tableStatus" class="text-center p-4 text-gray-500">Loading entries...</div>
            <div class="table-container overflow-x-auto bg-white rounded-lg shadow">
                <table class="min-w-full divide-y divide-gray-200 responsive-table">
                    <thead id="entriesTableHead" class="bg-gray-50">
                        <tr>
                            </tr>
                    </thead>
                    <tbody id="entriesTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
             <div id="paginationControls" class="mt-3 sm:mt-4 flex justify-center items-center space-x-1 sm:space-x-2"></div>
        </section>
    </div>

    <div id="messageAlertModal" class="modal"><div class="modal-content-wrapper">
        <div class="modal-content">
            <span class="close-button" onclick="closeAlertModal()">&times;</span>
            <p id="modalMessage" class="text-gray-700 text-center"></p>
            <div class="mt-6 text-center default-modal-buttons"><button onclick="closeAlertModal()" class="btn btn-primary">OK</button></div>
            <div class="mt-6 flex justify-center space-x-3 confirm-buttons" style="display:none;"><button id="modalCancelButton" class="btn btn-secondary">Cancel</button><button id="modalConfirmButton" class="btn btn-danger">Confirm</button></div>
            <div class="mt-6 flex justify-center space-x-3 custom-choice-buttons" style="display:none;">
                </div>
        </div>
    </div></div>

    <footer class="py-4 sm:py-6 text-center text-xs sm:text-sm text-gray-500">
        © 2025 Build Wealth Realtors. All rights reserved.
    </footer>

    <script>
        // --- CONFIGURATION & GLOBAL VARS ---
        const VIEW_ENTRIES_URL = 'https://script.google.com/macros/s/AKfycbxz5aGhyb515CORivz9Ix3n6uJOGBEVxYYITXqRdpTWkJrqRK_9yL0g4YX6ivnzjKQV2A/exec';
        const MODIFY_ENTRIES_URL = 'https://sheetdb.io/api/v1/nydthm8eqg4w4';
        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSc9Na1QZsDukXu0hkn3P70UzXRkMPdZtHe14Bsgq2sSU-sEKQ/viewform';

        const ITEMS_PER_PAGE = 5; // Changed from 10 to 5
        let currentPage = 1;
        let allEntries = [];
        // Removed currentSortColumn and currentSortDirection

        // --- HIRING FMS STATUSES ---
        const STATUS_PENDING_ACCEPTANCE = "Pending: Acceptance & Contract Signing";
        const STATUS_PENDING_ONBOARDING = "Pending: Onboarding & Documentation";
        const STATUS_PENDING_KIT_HANDOVER = "Pending: Introduction & Employee Kit Handover";
        const STATUS_PENDING_TRAINING = "Pending: Training & Introduction";
        const STATUS_PENDING_ROLE_HANDOVER = "Pending: Role & Work Handover";
        const STATUS_PROCESS_COMPLETED = "Process Completed";


        const STATUS_MAP = {
            PENDING_ACCEPTANCE: STATUS_PENDING_ACCEPTANCE,
            PENDING_ONBOARDING: STATUS_PENDING_ONBOARDING,
            PENDING_KIT_HANDOVER: STATUS_PENDING_KIT_HANDOVER,
            PENDING_TRAINING: STATUS_PENDING_TRAINING,
            PENDING_ROLE_HANDOVER: STATUS_PENDING_ROLE_HANDOVER,
            PROCESS_COMPLETED: STATUS_PROCESS_COMPLETED,
        };

        const HIRING_STAGES = [
            { stageKey: 'AcceptanceContract', name: "Acceptance & Contract Signing", plannedKey: "Acceptance & Contract singning Planned", actualKey: "Acceptance & Contract singning Actual", timeDelayKey: "Acceptance & Contract singning Time Delay", takeActionKey: "Take Action (Acceptance & Contract singning)", nextStatus: STATUS_MAP.PENDING_ONBOARDING, buttonText: "Take Action" },
            { stageKey: 'OnboardingDocumentation', name: "Onboarding & Documentation", plannedKey: "Onboarding & Documentation Planned", actualKey: "Onboarding & Documentation Actual", timeDelayKey: "Onboarding & Documentation Time Delay", takeActionKey: "Take Action (Onboarding & Documentation)", nextStatus: STATUS_MAP.PENDING_KIT_HANDOVER, buttonText: "Take Action" },
            { stageKey: 'IntroKitHandover', name: "Introduction & Employee Kit Handover", plannedKey: "Introduction & Employee Kit Handover Planned", actualKey: "Introduction & Employee Kit Handover Actual", timeDelayKey: "Introduction & Employee Kit Handover Time Delay", takeActionKey: "Take Action (Introduction & Employee Kit Handover)", nextStatus: STATUS_MAP.PENDING_TRAINING, buttonText: "Take Action" },
            { stageKey: 'TrainingIntroduction', name: "Training & Introduction", plannedKey: "Training & Introduction Planned", actualKey: "Training & Introduction Actual", timeDelayKey: "Training & Introduction Time Delay", takeActionKey: "Take Action (Training & Introduction)", nextStatus: STATUS_MAP.PENDING_ROLE_HANDOVER, buttonText: "Take Action" },
            { stageKey: 'RoleWorkHandover', name: "Role & Work Handover", plannedKey: "Role & Work Handover Planned", actualKey: "Role & Work Handover Actual", timeDelayKey: "Role & Work Handover Time Delay", takeActionKey: "Take Action (Role & Work Handover)", nextStatus: STATUS_MAP.PROCESS_COMPLETED, buttonText: "Take Action" }
        ];

        const tableHeadersConfig = [ // Removed 'sortable' property from all
            { key: 'UID', label: 'UID' },
            { key: 'Timestamp', label: 'Timestamp', isDate: true },
            { key: 'Candidate Name', label: 'Candidate Name' },
            { key: 'Mobile Number', label: 'Mobile' },
            { key: 'Designation ', label: 'Designation' },
            { key: 'status', label: 'Status' },
            { key: 'nextPlannedActionOn', label: 'Next Planned On', isDate: true, customRender: (entry) => getNextPlannedActionTimestamp(entry) },
            { key: 'actions', label: 'Actions' }
        ];


        // --- DOM ELEMENTS ---
        const addEntrySectionModal = document.getElementById('addEntrySectionModal');
        const openEntryFormModalButton = document.getElementById('openEntryFormModalButton');
        const closeEntryFormModalButton = document.getElementById('closeEntryFormModalButton');

        const doerInfoModal = document.getElementById('doerInfoModal');
        const openDoerInfoModalButton = document.getElementById('openDoerInfoModalButton');
        const closeDoerInfoModalButton = document.getElementById('closeDoerInfoModalButton');
        const okDoerInfoModalButton = document.getElementById('okDoerInfoModalButton');

        const howToUseModal = document.getElementById('howToUseModal');
        const openHowToUseModalButton = document.getElementById('openHowToUseModalButton');
        const closeHowToUseModalButton = document.getElementById('closeHowToUseModalButton');
        const okHowToUseModalButton = document.getElementById('okHowToUseModalButton');

        const openBackendDataButton = document.getElementById('openBackendDataButton');


        const entryDetailsModal = document.getElementById('entryDetailsModal');
        const detailsModalTitle = document.getElementById('detailsModalTitle');
        const detailsModalSubtitle = document.getElementById('detailsModalSubtitle');
        const detailsModalContent = document.getElementById('detailsModalContent');

        const messageAlertModal = document.getElementById('messageAlertModal');
        const modalMessage = document.getElementById('modalMessage');
        const defaultModalButtons = messageAlertModal.querySelector('.default-modal-buttons');
        const confirmModalButtons = messageAlertModal.querySelector('.confirm-buttons');
        const modalConfirmButton = document.getElementById('modalConfirmButton');
        const modalCancelButton = document.getElementById('modalCancelButton');
        const customChoiceButtonsContainer = messageAlertModal.querySelector('.custom-choice-buttons');


        const entriesTableHead = document.getElementById('entriesTableHead');
        const entriesTableBody = document.getElementById('entriesTableBody');
        const tableStatus = document.getElementById('tableStatus');
        const searchInput = document.getElementById('searchInput');
        const paginationControls = document.getElementById('paginationControls');

        const scorecardTotalCandidates = document.getElementById('scorecardTotalCandidates');
        const scorecardPendingAcceptance = document.getElementById('scorecardPendingAcceptance');
        const scorecardPendingOnboarding = document.getElementById('scorecardPendingOnboarding');
        const scorecardPendingKitHandover = document.getElementById('scorecardPendingKitHandover');
        const scorecardPendingTraining = document.getElementById('scorecardPendingTraining');
        const scorecardPendingRoleHandover = document.getElementById('scorecardPendingRoleHandover');
        const scorecardProcessCompleted = document.getElementById('scorecardProcessCompleted');

        const entranceAnimationOverlay = document.getElementById('entranceAnimationOverlay');

        // Filter Elements
        const statusFilter = document.getElementById('statusFilter');
        const dateStartFilter = document.getElementById('dateStartFilter');
        const dateEndFilter = document.getElementById('dateEndFilter');
        const designationFilter = document.getElementById('designationFilter');
        const actionStatusFilter = document.getElementById('actionStatusFilter');
        const clearFiltersButton = document.getElementById('clearFiltersButton');


        // --- MODAL CONTROL FUNCTIONS ---
        function openModal(modalElement) {
            const modalContent = modalElement.querySelector('.modal-content');
            if (modalContent) {
                modalContent.classList.remove('modal-popup-active');
                void modalContent.offsetWidth;
                modalContent.classList.add('modal-popup-active');
            }
            modalElement.style.display = "flex";
        }
        function closeModal(modalElement) {
            const modalContent = modalElement.querySelector('.modal-content');
            if (modalContent) {
            }
            modalElement.style.display = "none";
        }

        function openDoerModal() { openModal(doerInfoModal); }
        function openHowToUse() { openModal(howToUseModal); }

        function openEntryDetailsModal(entryId) {
            const entry = allEntries.find(e => e.UID === entryId);
            if (!entry) {
                showUserAlert("Error: Could not find entry details for UID: " + entryId, "error");
                return;
            }
            detailsModalTitle.textContent = `Candidate Details - ${entry['Candidate Name'] || entry.UID}`;
            detailsModalSubtitle.textContent = `Current Status: ${entry.status || determineHiringStatus(entry)}`;
            populateDetailsModal(entry);
            openModal(entryDetailsModal);
        }

        function showUserAlert(message, type = 'info', onConfirm = null, customButtons = null) {
            modalMessage.textContent = message;
            openModal(messageAlertModal);

            defaultModalButtons.style.display = 'none';
            confirmModalButtons.style.display = 'none';
            customChoiceButtonsContainer.style.display = 'none';
            customChoiceButtonsContainer.innerHTML = '';

            if (type === 'confirm' && onConfirm) {
                confirmModalButtons.style.display = 'flex';
                modalConfirmButton.textContent = 'Confirm';

                modalConfirmButton.onclick = () => { onConfirm(); };
                modalCancelButton.onclick = closeAlertModal;
            } else if (type === 'choice' && customButtons) {
                customChoiceButtonsContainer.style.display = 'flex';
                customButtons.forEach(btnConfig => {
                    const button = document.createElement('button');
                    button.textContent = btnConfig.text;
                    button.className = `btn ${btnConfig.class || 'btn-secondary'} ml-2`;
                    button.onclick = () => {
                        closeAlertModal();
                        btnConfig.handler();
                    };
                    customChoiceButtonsContainer.appendChild(button);
                });
                const cancelBtnChoice = document.createElement('button');
                cancelBtnChoice.textContent = "Cancel";
                cancelBtnChoice.className = "btn btn-secondary ml-2";
                cancelBtnChoice.onclick = closeAlertModal;
                customChoiceButtonsContainer.insertBefore(cancelBtnChoice, customChoiceButtonsContainer.firstChild);


            } else {
                defaultModalButtons.style.display = 'block';
            }

            modalMessage.classList.remove('text-green-600', 'text-red-600');
            if (type === 'success') modalMessage.classList.add('text-green-600');
            if (type === 'error') modalMessage.classList.add('text-red-600');
        }
        function closeAlertModal() { closeModal(messageAlertModal); }

        window.onclick = (event) => {
            const modals = [addEntrySectionModal, doerInfoModal, entryDetailsModal, messageAlertModal, howToUseModal];
            modals.forEach(modal => {
                if (modal && modal.style.display === "flex" && event.target === modal) {
                    closeModal(modal);
                }
            });
        }

        // --- UTILITY FUNCTIONS ---
        function setButtonLoading(isLoading, button, spinner) {
            if (!button) return;
            button.disabled = isLoading; button.classList.toggle('opacity-50', isLoading);
            if (spinner) spinner.classList.toggle('hidden', !isLoading);
        }

        function formatDateForDisplay(dateTimeStringOrObject) {
            if (!dateTimeStringOrObject || dateTimeStringOrObject === 'N/A' || String(dateTimeStringOrObject).trim() === "") return 'N/A';
            let date;
            if (dateTimeStringOrObject instanceof Date) {
                date = dateTimeStringOrObject;
            } else {
                const customFormatRegex = /^(\d{2})-([A-Za-z]{3})-(\d{4}) (\d{2}):(\d{2}):(\d{2}) (AM|PM)$/;
                const match = typeof dateTimeStringOrObject === 'string' ? dateTimeStringOrObject.match(customFormatRegex) : null;
                if (match) {
                    const months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
                    let hours = parseInt(match[4], 10);
                    if (match[7] === 'PM' && hours < 12) hours += 12;
                    if (match[7] === 'AM' && hours === 12) hours = 0;
                    date = new Date(match[3], months[match[2]], match[1], hours, match[5], match[6]);
                } else {
                    date = new Date(dateTimeStringOrObject);
                }
            }

            if (isNaN(date.getTime())) {
                return dateTimeStringOrObject.toString();
            }
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const day = String(date.getDate()).padStart(2, '0');
            const monthName = months[date.getMonth()];
            const year = date.getFullYear();
            let hours = date.getHours();
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            const strHours = String(hours).padStart(2, '0');
            return `${day}-${monthName}-${year} ${strHours}:${minutes}:${seconds} ${ampm}`;
        }

         function formatDateForInput(date) {
            if (!(date instanceof Date) || isNaN(date.getTime())) {
                date = new Date();
            }
            const offset = date.getTimezoneOffset();
            const adjustedDate = new Date(date.getTime() - (offset*60*1000));
            return adjustedDate.toISOString().slice(0,16);
        }
        function addDays(dateInput, days) {
            const result = new Date(dateInput);
            result.setDate(result.getDate() + days);
            return result;
        }
        function calculateTimeDelay(actualTimestamp, plannedTimestamp) {
            if (!actualTimestamp || !plannedTimestamp || actualTimestamp === "N/A" || plannedTimestamp === "N/A" || String(actualTimestamp).trim() === "" || String(plannedTimestamp).trim() === "" || actualTimestamp === "SKIPPED" || plannedTimestamp === "SKIPPED") return "<span class='text-gray-400'>N/A</span>";

            const parseCustomDateString = (dateStr) => {
                if (!dateStr || typeof dateStr !== 'string') return null;
                const parts = dateStr.match(/(\d{2})-([A-Za-z]{3})-(\d{4}) (\d{2}):(\d{2}):(\d{2}) (AM|PM)/);
                if (!parts) return new Date(dateStr);
                const months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
                let hours = parseInt(parts[4], 10);
                if (parts[7] === 'PM' && hours < 12) hours += 12;
                if (parts[7] === 'AM' && hours === 12) hours = 0;
                return new Date(parts[3], months[parts[2]], parts[1], hours, parts[5], parts[6]);
            };

            const actual = (actualTimestamp instanceof Date) ? actualTimestamp : parseCustomDateString(actualTimestamp);
            const planned = (plannedTimestamp instanceof Date) ? plannedTimestamp : parseCustomDateString(plannedTimestamp);

            if (!actual || isNaN(actual.getTime()) || !planned || isNaN(planned.getTime())) {
                 return "<span class='text-gray-400'>Invalid Date</span>";
            }

            const diff = actual.getTime() - planned.getTime();
            const d = Math.floor(diff/(1000*60*60*24)), h = Math.floor((diff%(1000*60*60*24))/(1000*60)), m = Math.floor((diff%(1000*60*60))/(1000*60));
            let delayClass = 'delay-ontime'; let delayText = "On Time";
            if (diff > 0) {
                delayClass = 'delay-late';
                if (d > 0) delayText = `${d}d late`; else if (h > 0) delayText = `${h}h late`; else if (m > 0) delayText = `${m}m late`; else delayText = "Delayed";
            } else if (diff < 0) {
                 delayClass = 'delay-early';
                 if (Math.abs(d) > 0) delayText = `${Math.abs(d)}d early`; else if (Math.abs(h) > 0) delayText = `${Math.abs(h)}h early`; else delayText = "Early";
            }
            return `<span class="${delayClass}">${delayText}</span>`;
        }

        // --- SCORECARD FUNCTIONS ---
        function renderScorecards(entries) {
            scorecardTotalCandidates.textContent = entries.length;
            scorecardPendingAcceptance.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PENDING_ACCEPTANCE).length;
            scorecardPendingOnboarding.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PENDING_ONBOARDING).length;
            scorecardPendingKitHandover.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PENDING_KIT_HANDOVER).length;
            scorecardPendingTraining.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PENDING_TRAINING).length;
            scorecardPendingRoleHandover.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PENDING_ROLE_HANDOVER).length;
            scorecardProcessCompleted.textContent = entries.filter(e => determineHiringStatus(e) === STATUS_MAP.PROCESS_COMPLETED).length;
        }

        // --- TABLE SORTING FUNCTIONS ---
        // Sorting functionality (handleSort, applySorting, applySortingToFiltered) removed.
        function initializeTableHeaders() {
            const headerRow = entriesTableHead.querySelector('tr') || entriesTableHead.appendChild(document.createElement('tr'));
            headerRow.innerHTML = '';

            tableHeadersConfig.forEach(config => {
                const th = document.createElement('th');
                th.className = 'px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                th.textContent = config.label;
                // No sorting related attributes or event listeners added
                headerRow.appendChild(th);
            });
        }

        // --- EVENT LISTENERS & INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeTableHeaders();
            fetchEntries().then(populateFilterDropdowns);

            openEntryFormModalButton.addEventListener('click', () => {
                window.open(GOOGLE_FORM_URL, '_blank');
            });
            closeEntryFormModalButton.addEventListener('click', () => closeModal(addEntrySectionModal));

            openDoerInfoModalButton.addEventListener('click', openDoerModal);
            closeDoerInfoModalButton.addEventListener('click', () => closeModal(doerInfoModal));
            if(okDoerInfoModalButton) okDoerInfoModalButton.addEventListener('click', () => closeModal(doerInfoModal));

            if(openBackendDataButton) {
                openBackendDataButton.addEventListener('click', () => {
                    window.open('https://docs.google.com/spreadsheets/d/13dYpkDy2ksT28soOVRuPcswr8XkcI4JTOQlf94FS5aM/edit?gid=1875065207#gid=1875065207', '_blank');
                });
            }


            openHowToUseModalButton.addEventListener('click', openHowToUse);
            closeHowToUseModalButton.addEventListener('click', () => closeModal(howToUseModal));
            okHowToUseModalButton.addEventListener('click', () => closeModal(howToUseModal));

            modalCancelButton.onclick = closeAlertModal;

             // Dashboard Header JS
            updateDateTime();
            setInterval(updateDateTime, 1000);

            const syncButton = document.getElementById('syncButton');
            if (syncButton) {
                syncButton.addEventListener('click', () => {
                    const svgIcon = syncButton.querySelector('svg');
                    if (svgIcon) {
                        svgIcon.classList.add('rotate-animate');
                    }
                    syncButton.disabled = true;
                    console.log("Syncing data via dashboard header button...");
                    fetchEntries()
                        .then(() => {
                            showUserAlert("Data synced successfully!", "success");
                            populateFilterDropdowns(); // Repopulate filters after sync
                        })
                        .catch(error => {
                            console.error("Error during header sync:", error);
                        })
                        .finally(() => {
                            if (svgIcon) {
                                svgIcon.classList.remove('rotate-animate');
                            }
                            syncButton.disabled = false;
                        });
                });
            }

            // Filter event listeners
            searchInput.addEventListener('input', applyFiltersAndSearch);
            statusFilter.addEventListener('change', applyFiltersAndSearch);
            dateStartFilter.addEventListener('change', applyFiltersAndSearch);
            dateEndFilter.addEventListener('change', applyFiltersAndSearch);
            designationFilter.addEventListener('change', applyFiltersAndSearch);
            actionStatusFilter.addEventListener('change', applyFiltersAndSearch);
            clearFiltersButton.addEventListener('click', () => {
                searchInput.value = '';
                statusFilter.value = '';
                dateStartFilter.value = '';
                dateEndFilter.value = '';
                designationFilter.value = '';
                actionStatusFilter.value = '';
                applyFiltersAndSearch();
            });

        });

        // --- Function to determine current status for Hiring FMS ---
        function determineHiringStatus(entry) {
            if (entry[HIRING_STAGES[4].actualKey]) return STATUS_MAP.PROCESS_COMPLETED;
            if (entry[HIRING_STAGES[3].actualKey]) return STATUS_MAP.PENDING_ROLE_HANDOVER;
            if (entry[HIRING_STAGES[2].actualKey]) return STATUS_MAP.PENDING_TRAINING;
            if (entry[HIRING_STAGES[1].actualKey]) return STATUS_MAP.PENDING_KIT_HANDOVER;
            if (entry[HIRING_STAGES[0].actualKey]) return STATUS_MAP.PENDING_ONBOARDING;
            return STATUS_MAP.PENDING_ACCEPTANCE;
        }


        async function processHiringStep(entryUID, buttonElement, stageIndex) {
            if(buttonElement) setButtonLoading(true, buttonElement, null);
            const entryIdx = allEntries.findIndex(e => e.UID === entryUID);
            if (entryIdx === -1) {
                showUserAlert('Error: Entry not found for update.', 'error');
                if(buttonElement) setButtonLoading(false, buttonElement, null);
                return;
            }

            const now = new Date();
            const entryToUpdateLocally = { ...allEntries[entryIdx] };
            const currentStage = HIRING_STAGES[stageIndex];

            const dataToUpdatePayload = {};
            dataToUpdatePayload[currentStage.actualKey] = formatDateForDisplay(now);

            const plannedTimestamp = entryToUpdateLocally[currentStage.plannedKey];
            if (plannedTimestamp && plannedTimestamp !== "SKIPPED" && plannedTimestamp !== "N/A") {
                 const plannedDate = new Date(String(plannedTimestamp).replace(/-/g, " ").replace(" AM", "").replace(" PM", ""));
                 if (!isNaN(plannedDate.getTime())) {
                    dataToUpdatePayload[currentStage.timeDelayKey] = calculateTimeDelay(now, plannedDate).replace(/<[^>]*>?/gm, '');
                 } else {
                    dataToUpdatePayload[currentStage.timeDelayKey] = "N/A";
                 }
            } else {
                 dataToUpdatePayload[currentStage.timeDelayKey] = "N/A";
            }

            if (stageIndex + 1 < HIRING_STAGES.length) {
                const nextStage = HIRING_STAGES[stageIndex + 1];
                dataToUpdatePayload[nextStage.plannedKey] = formatDateForDisplay(addDays(now, 2));
            }

            const newStatus = currentStage.nextStatus;

            try {
                const updateUrl = `${MODIFY_ENTRIES_URL}/UID/${entryToUpdateLocally.UID}`;
                const res = await fetch(updateUrl, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: dataToUpdatePayload })
                });
                if (res.ok) {
                    showUserAlert(`Entry ${entryToUpdateLocally.UID} updated to "${newStatus}"!`, 'success');

                    Object.assign(allEntries[entryIdx], dataToUpdatePayload);
                    allEntries[entryIdx].status = newStatus;

                    applyFiltersAndSearch(); // Use combined filter and render function
                    if (entryDetailsModal.style.display === "flex") {
                         const currentModalEntry = allEntries.find(e => e.UID === entryUID);
                         if(currentModalEntry) populateDetailsModal(currentModalEntry);
                    }
                } else {
                    const errorResult = await res.json().catch(() => ({ message: 'Unknown error' }));
                    showUserAlert('Error updating status: ' + (errorResult.error || errorResult.message || res.statusText), 'error');
                }
            } catch (e) {
                console.error('Error updating status:', e);
                showUserAlert('Network error: ' + e.message, 'error');
            } finally {
                if(buttonElement) setButtonLoading(false, buttonElement, null);
            }
        }

        // --- ENTRY DETAILS MODAL ---
        function populateDetailsModal(entry) {
            detailsModalContent.innerHTML = '';

            const modalContentSection = entryDetailsModal.querySelector('.modal-content');

            const existingControlsGroup = modalContentSection.querySelector('.modal-controls-group');
            if (existingControlsGroup) existingControlsGroup.remove();

            const controlsGroup = document.createElement('div');
            controlsGroup.className = 'modal-controls-group';

            const newCloseButton = document.createElement('button');
            newCloseButton.className = 'modal-control-button close-btn';
            newCloseButton.title = 'Close';
            newCloseButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>`;
            newCloseButton.onclick = () => closeModal(entryDetailsModal);
            controlsGroup.appendChild(newCloseButton);

            if (modalContentSection) {
                 modalContentSection.insertBefore(controlsGroup, modalContentSection.firstChild);
            }

            const cardDiv = document.createElement('div');
            cardDiv.className = 'crm-card';

            const overviewTitle = document.createElement('h2');
            overviewTitle.textContent = 'Candidate Overview';
            cardDiv.appendChild(overviewTitle);

            const createSectionItem = (label, value, isHtml = false) => {
                const item = document.createElement('div'); item.className = 'crm-description-item';
                const lbl = document.createElement('div'); lbl.className = 'crm-label'; lbl.textContent = label + ':';
                const val = document.createElement('div'); val.className = 'crm-value';
                if (isHtml) {
                    val.innerHTML = value || '<span class="text-gray-400">N/A</span>';
                } else {
                    val.textContent = value || 'N/A';
                }
                item.append(lbl, val);
                return item;
            };

            const mainDetailsSection = document.createElement('div');
            mainDetailsSection.className = 'crm-section';
            mainDetailsSection.style.cssText = '--section-color: #3f51b5; --section-bg: rgba(63, 81, 181, 0.07);';
            mainDetailsSection.innerHTML = `<div class="crm-section-header"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg><span>Candidate Information</span></div><div class="crm-section-content grid grid-cols-1 md:grid-cols-2 gap-x-4"></div>`;
            const mainContent = mainDetailsSection.querySelector('.crm-section-content');

            mainContent.appendChild(createSectionItem('UID', entry.UID));
            mainContent.appendChild(createSectionItem('Timestamp', formatDateForDisplay(entry.Timestamp)));
            mainContent.appendChild(createSectionItem('Candidate Name', entry['Candidate Name']));
            mainContent.appendChild(createSectionItem('Mobile Number', entry['Mobile Number']));
            mainContent.appendChild(createSectionItem('Address', entry['Address ']));
            mainContent.appendChild(createSectionItem('Designation', entry['Designation ']));
            mainContent.appendChild(createSectionItem('Resume', entry.Resume ? `<a href="${entry.Resume}" target="_blank" class="text-indigo-600 hover:underline">View Resume</a>` : 'N/A', true));
            mainContent.appendChild(createSectionItem('Current Status', entry.status || determineHiringStatus(entry)));

            cardDiv.appendChild(mainDetailsSection);

            const stageProcessingSection = document.createElement('div');
            stageProcessingSection.className = 'details-section mt-6';
            const stageProcessingTitle = document.createElement('h3');
            stageProcessingTitle.textContent = 'Hiring Stage Processing';
            stageProcessingSection.appendChild(stageProcessingTitle);

            const currentOverallStatus = entry.status || determineHiringStatus(entry);
            let actionButtonAddedForCurrentPendingStage = false;

            HIRING_STAGES.forEach((stage, index) => {
                const stageDiv = document.createElement('div');
                stageDiv.className = 'timeline-step';
                stageDiv.innerHTML = `<strong>${stage.name}</strong>
                                   <div class="timeline-details-grid mt-2">
                                     ${createSectionItem('Planned', formatDateForDisplay(entry[stage.plannedKey])).outerHTML}
                                     ${createSectionItem('Actual', formatDateForDisplay(entry[stage.actualKey])).outerHTML}
                                     ${createSectionItem('Time Delay', calculateTimeDelay(entry[stage.actualKey], entry[stage.plannedKey]), true).outerHTML}
                                   </div>`;

                if (!actionButtonAddedForCurrentPendingStage && !entry[stage.actualKey]) {
                     const actionButtonContainer = document.createElement('div');
                     actionButtonContainer.className = 'action-button-group';

                     const actionButton = document.createElement('button');
                     const actionUrl = entry[stage.takeActionKey];

                     if (actionUrl && (actionUrl.startsWith('http://') || actionUrl.startsWith('https://'))) {
                        actionButton.textContent = "Take Action (External)";
                        actionButton.className = 'btn btn-info btn-take-action';
                        actionButton.onclick = () => {
                            window.open(actionUrl, '_blank');
                        };
                        actionButtonContainer.appendChild(actionButton);

                        const syncStageButton = document.createElement('button');
                        syncStageButton.className = 'modal-control-button sync-btn btn-icon-only p-1.5';
                        syncStageButton.title = 'Sync Stage Data';
                        syncStageButton.innerHTML = `<svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>`;
                        syncStageButton.onclick = () => {
                            const svgIcon = syncStageButton.querySelector('svg');
                            if (svgIcon) svgIcon.classList.add('rotate-animate');
                            syncStageButton.disabled = true;
                            fetchEntries().then(() => {
                                showUserAlert("Entry details refreshed and data synced!", "success");
                                const updatedEntry = allEntries.find(e => e.UID === entry.UID);
                                if (updatedEntry) {
                                    populateDetailsModal(updatedEntry);
                                    detailsModalSubtitle.textContent = `Current Status: ${updatedEntry.status || determineHiringStatus(updatedEntry)}`;
                                } else {
                                    closeModal(entryDetailsModal);
                                    showUserAlert('Entry details may have changed or an error occurred.', 'info');
                                }
                            }).catch(err => {
                                showUserAlert('Error syncing details: ' + err.message, 'error');
                            }).finally(() => {
                                if (svgIcon) svgIcon.classList.remove('rotate-animate');
                                syncStageButton.disabled = false;
                            });
                        };
                        actionButtonContainer.appendChild(syncStageButton);

                     } else {
                        actionButton.textContent = "Take Action";
                        actionButton.className = 'btn btn-success btn-take-action';
                        actionButton.onclick = () => {
                            showUserAlert(`Confirm completion of "${stage.name}"?`, 'confirm', () => {
                                processHiringStep(entry.UID, actionButton, index);
                            });
                        };
                        actionButtonContainer.appendChild(actionButton);
                     }
                     stageDiv.appendChild(actionButtonContainer);
                     actionButtonAddedForCurrentPendingStage = true;
                }
                stageProcessingSection.appendChild(stageDiv);
            });

            cardDiv.appendChild(stageProcessingSection);
            detailsModalContent.appendChild(cardDiv);
        }


        async function fetchEntries() {
            tableStatus.textContent = 'Loading entries...';
            tableStatus.classList.remove('hidden');
            entriesTableBody.innerHTML = '';
            paginationControls.innerHTML = '';
            const entranceOverlay = document.getElementById('entranceAnimationOverlay');


            if (VIEW_ENTRIES_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.warn("VIEW_ENTRIES_URL is still the placeholder. Using local demo data for fetchEntries.");
                 if (allEntries.length === 0) {
                    const now = new Date(); const step1Time = new Date(now.getTime() - 25 * 24 * 60 * 60 * 1000);
                    allEntries = [
                        {
                            UID: 'UID01', Timestamp: formatDateForInput(step1Time),
                            'Candidate Name': 'Andy (Demo)', 'Mobile Number':"1234567890",
                            'Address ': 'Dharwad', 'Designation ': 'Manager',
                            'Resume': 'www.google.com',
                            'Take Action (Acceptance & Contract singning)': '',
                            'Acceptance & Contract singning Planned': formatDateForDisplay(addDays(step1Time, 2)),
                            'Acceptance & Contract singning Actual': null,
                            'Acceptance & Contract singning Time Delay': null,
                            'Take Action (Onboarding & Documentation)': '',
                            'Onboarding & Documentation Planned': null,
                            'Onboarding & Documentation Actual': null,
                            'Onboarding & Documentation Time Delay': null,
                            'Take Action (Introduction & Employee Kit Handover)': '',
                            'Introduction & Employee Kit Handover Planned': null,
                            'Introduction & Employee Kit Handover Actual': null,
                            'Introduction & Employee Kit Handover Time Delay': null,
                            'Take Action (Training & Introduction)': '',
                            'Training & Introduction Planned': null,
                            'Training & Introduction Actual': null,
                            'Training & Introduction Time Delay': null,
                            'Take Action (Role & Work Handover)': '',
                            'Role & Work Handover Planned': null,
                            'Role & Work Handover Actual': null,
                            'Role & Work Handover Time Delay': null
                        }
                    ];
                }
                allEntries.forEach(entry => entry.status = determineHiringStatus(entry));
                renderTable(allEntries); // No sorting applied before rendering
                tableStatus.classList.toggle('hidden', allEntries.length > 0);
                if (allEntries.length === 0) tableStatus.textContent = 'No entries (demo).';
                if(entranceOverlay) entranceOverlay.classList.add('hidden');
                return;
            }
            try {
                const res = await fetch(`${VIEW_ENTRIES_URL}?action=getEntries`);
                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(`Failed to fetch: ${res.status} ${res.statusText} - ${errorText}`);
                }
                const result = await res.json();
                console.log('Raw response from Apps Script:', result);

                let dataToProcess = [];
                if (result && result.success && Array.isArray(result.data)) {
                    dataToProcess = result.data;
                } else if (Array.isArray(result)) {
                     console.warn("Apps Script returned a direct array. Expected {success: true, data: [...]}. Adapting...");
                    dataToProcess = result;
                } else {
                    tableStatus.textContent = 'Error fetching entries: '+(result.message ||'Invalid data format received from script.');
                    showUserAlert('Error fetching entries: '+(result.message ||'Invalid data format received from script.'),'error');
                    if(entranceOverlay) entranceOverlay.classList.add('hidden');
                    return;
                }

                allEntries = dataToProcess.map(e=>({...e,
                    status: determineHiringStatus(e)
                })); // Sorting removed
                currentPage = 1;
                applyFiltersAndSearch();
                tableStatus.classList.toggle('hidden', allEntries.length > 0);
                if (allEntries.length === 0) tableStatus.textContent = 'No entries found.';

            } catch (e) {
                console.error('Error fetching entries:', e);
                tableStatus.textContent = 'Failed to load entries. Check console and SCRIPT_URL.';
                showUserAlert('Network error while fetching entries: '+e.message,'error');
            } finally {
                if(entranceOverlay) entranceAnimationOverlay.classList.add('hidden');
            }
        }

        function populateFilterDropdowns() {
            // Populate Status Filter
            statusFilter.innerHTML = '<option value="">All Statuses</option>'; // Reset
            Object.values(STATUS_MAP).forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                statusFilter.appendChild(option);
            });

            // Populate Designation Filter
            const designations = [...new Set(allEntries.map(entry => entry['Designation ']?.trim()).filter(Boolean))].sort();
            designationFilter.innerHTML = '<option value="">All Designations</option>'; // Reset
            designations.forEach(designation => {
                const option = document.createElement('option');
                option.value = designation;
                option.textContent = designation;
                designationFilter.appendChild(option);
            });
        }

        function applyFiltersAndSearch() {
            let filteredEntries = [...allEntries];
            const searchTerm = searchInput.value.toLowerCase();
            const selectedStatus = statusFilter.value;
            const startDate = dateStartFilter.value ? new Date(dateStartFilter.value) : null;
            const endDate = dateEndFilter.value ? new Date(dateEndFilter.value) : null;
            const selectedDesignation = designationFilter.value;
            const selectedActionStatus = actionStatusFilter.value;

            if (startDate) startDate.setHours(0,0,0,0); // Normalize to start of day
            if (endDate) endDate.setHours(23,59,59,999); // Normalize to end of day


            filteredEntries = filteredEntries.filter(entry => {
                // Search Term
                const searchMatch = Object.values(entry).some(val =>
                    String(val).toLowerCase().includes(searchTerm)
                );

                // Status Filter
                const statusMatch = !selectedStatus || (entry.status || determineHiringStatus(entry)) === selectedStatus;

                // Date Range Filter
                let dateMatch = true;
                if (entry.Timestamp) {
                    const entryDate = new Date(String(entry.Timestamp).replace(/-/g, " ").replace(" AM", "").replace(" PM", ""));
                    if (!isNaN(entryDate.getTime())) {
                        if (startDate && entryDate < startDate) dateMatch = false;
                        if (endDate && entryDate > endDate) dateMatch = false;
                    } else {
                        if(startDate || endDate) dateMatch = false; // If dates are filtered but entry has invalid timestamp
                    }
                } else if (startDate || endDate) {
                     dateMatch = false; // No timestamp but date filter applied
                }


                // Designation Filter
                const designationMatch = !selectedDesignation || (entry['Designation ']?.trim() === selectedDesignation);

                // Overdue/Upcoming Actions Filter
                let actionStatusMatch = true;
                if (selectedActionStatus) {
                    const plannedActionInfo = getNextPlannedActionTimestamp(entry);
                    if (plannedActionInfo.date) { // Check if a valid date was returned
                        const today = new Date();
                        today.setHours(0,0,0,0);
                        const sevenDaysFromNow = new Date(today);
                        sevenDaysFromNow.setDate(today.getDate() + 7);

                        if (selectedActionStatus === 'overdue') {
                            actionStatusMatch = plannedActionInfo.isOverdue;
                        } else if (selectedActionStatus === 'upcoming') {
                            actionStatusMatch = plannedActionInfo.date >= today && plannedActionInfo.date <= sevenDaysFromNow && !plannedActionInfo.isOverdue;
                        }
                    } else {
                        actionStatusMatch = false; // No planned action date, so doesn't match overdue/upcoming
                    }
                }

                return searchMatch && statusMatch && dateMatch && designationMatch && actionStatusMatch;
            });

            // Removed call to applySortingToFiltered
            renderTable(filteredEntries); // Render the filtered list (original order preserved within filter)
        }

        // applySortingToFiltered function removed as sorting is disabled.


        // --- TABLE RENDERING FUNCTIONS ---
        function renderTable(entries) {
            entriesTableBody.innerHTML = ''; paginationControls.innerHTML = '';
            renderScorecards(allEntries); // Update scorecards based on ALL entries, not just filtered ones

            tableStatus.classList.toggle('hidden', entries.length > 0);
            if (entries.length === 0) {
                if (allEntries.length > 0 && (searchInput.value || statusFilter.value || dateStartFilter.value || dateEndFilter.value || designationFilter.value || actionStatusFilter.value)) {
                    tableStatus.textContent = 'No entries match your filters.';
                } else if (allEntries.length === 0 && VIEW_ENTRIES_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    tableStatus.textContent = 'No entries found.';
                } else if (allEntries.length === 0) {
                    tableStatus.textContent = 'No entries (demo mode).';
                }
            }

            const paginated = entries.slice((currentPage-1)*ITEMS_PER_PAGE, (currentPage-1)*ITEMS_PER_PAGE + ITEMS_PER_PAGE);

            paginated.forEach((entry, idx) => {
                const r = entriesTableBody.insertRow(); r.className = idx % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tableHeadersConfig.forEach(hConfig => {
                    if (hConfig.key === 'actions') return;
                    const c = r.insertCell();
                    let cellValue;
                    let cellHtml = '';
                    let isOverdue = false;

                    if (hConfig.customRender) {
                        const renderResult = hConfig.customRender(entry);
                        cellValue = renderResult.text || 'N/A';
                        isOverdue = renderResult.isOverdue || false;
                    } else if (hConfig.key === 'status') {
                        cellValue = entry.status || determineHiringStatus(entry);
                    } else {
                        cellValue = entry[hConfig.key];
                        cellValue = (hConfig.isDate && cellValue) ? formatDateForDisplay(cellValue) : (cellValue || 'N/A');
                    }

                    if (hConfig.key === 'status') {
                        let statusClass = 'status-default';
                        if (cellValue === STATUS_MAP.PENDING_ACCEPTANCE) statusClass = 'status-pending-acceptance';
                        else if (cellValue === STATUS_MAP.PENDING_ONBOARDING) statusClass = 'status-pending-onboarding';
                        else if (cellValue === STATUS_MAP.PENDING_KIT_HANDOVER) statusClass = 'status-pending-kit-handover';
                        else if (cellValue === STATUS_MAP.PENDING_TRAINING) statusClass = 'status-pending-training';
                        else if (cellValue === STATUS_MAP.PENDING_ROLE_HANDOVER) statusClass = 'status-pending-role-handover';
                        else if (cellValue === STATUS_MAP.PROCESS_COMPLETED) statusClass = 'status-process-completed';
                        cellHtml = `<span class="status-badge ${statusClass}">${cellValue}</span>`;
                    } else if (isOverdue) {
                        cellHtml = `<span class="overdue-task">${cellValue}</span>`;
                    }
                     else {
                        cellHtml = cellValue;
                    }
                    c.innerHTML = cellHtml;
                    c.setAttribute('data-label',hConfig.label);
                    c.className='px-3 py-2 text-xs text-gray-700';
                });
                const actCell = r.insertCell(); actCell.setAttribute('data-label','Actions'); actCell.className='px-3 py-2 whitespace-nowrap text-xs text-gray-700 text-right md:text-left flex items-center space-x-1';
                const viewButton = document.createElement('button');
                viewButton.className = 'btn btn-info btn-xs p-1.5 btn-icon-only';
                viewButton.title = 'View Details';
                viewButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/></svg>`;
                viewButton.onclick = () => openEntryDetailsModal(entry.UID);
                actCell.appendChild(viewButton);
            });
            renderPaginationControls(entries.length);
        }

        function getNextPlannedActionTimestamp(entry) {
            const currentStatus = entry.status || determineHiringStatus(entry);
            let plannedTimestampStr = 'N/A';
            let isOverdue = false;
            const now = new Date();
            let relevantPlannedKey = '';
            let dateObject = null;

            if(currentStatus === STATUS_MAP.PENDING_ACCEPTANCE) relevantPlannedKey = HIRING_STAGES[0].plannedKey;
            else if(currentStatus === STATUS_MAP.PENDING_ONBOARDING) relevantPlannedKey = HIRING_STAGES[1].plannedKey;
            else if(currentStatus === STATUS_MAP.PENDING_KIT_HANDOVER) relevantPlannedKey = HIRING_STAGES[2].plannedKey;
            else if(currentStatus === STATUS_MAP.PENDING_TRAINING) relevantPlannedKey = HIRING_STAGES[3].plannedKey;
            else if(currentStatus === STATUS_MAP.PENDING_ROLE_HANDOVER) relevantPlannedKey = HIRING_STAGES[4].plannedKey;

            if (relevantPlannedKey && entry[relevantPlannedKey] && String(entry[relevantPlannedKey]).trim() !== "") {
                plannedTimestampStr = formatDateForDisplay(entry[relevantPlannedKey]);
                const plannedDate = new Date(String(entry[relevantPlannedKey]).replace(/-/g, " ").replace(" AM", "").replace(" PM", ""));
                if (!isNaN(plannedDate.getTime())) {
                    dateObject = plannedDate;
                    if (plannedDate < now) isOverdue = true;
                }
            }
            return { text: plannedTimestampStr, isOverdue: isOverdue, date: dateObject };
        }


        function renderPaginationControls(total) {
            paginationControls.innerHTML=''; const totalPages=Math.ceil(total/ITEMS_PER_PAGE); if(totalPages<=1)return;
            const p=Object.assign(document.createElement('button'),{textContent:'Previous',className:'btn btn-secondary text-sm',disabled:currentPage===1,onclick:()=>{if(currentPage>1){currentPage--; applyFiltersAndSearch();}}});
            const n=Object.assign(document.createElement('button'),{textContent:'Next',className:'btn btn-secondary text-sm',disabled:currentPage===totalPages,onclick:()=>{if(currentPage<totalPages){currentPage++; applyFiltersAndSearch();}}});
            const i=Object.assign(document.createElement('span'),{textContent:`Page ${currentPage} of ${totalPages}`,className:'px-4 py-2 text-sm text-gray-700'});
            paginationControls.append(p,i,n);
        }

        // Dashboard Header JS
        function updateDateTime() {
            const dateTimeDisplay = document.getElementById('dateTimeDisplay');
            if (dateTimeDisplay) {
                const now = new Date();
                const options = {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                };
                dateTimeDisplay.textContent = now.toLocaleString('en-US', options);
            }
        }

        const dashboardSyncButton = document.getElementById('syncButton');
        if (dashboardSyncButton) {
            dashboardSyncButton.addEventListener('click', () => {
                const svgIcon = dashboardSyncButton.querySelector('svg');
                if (svgIcon) {
                    svgIcon.classList.add('rotate-animate');
                }
                dashboardSyncButton.disabled = true;
                console.log("Syncing data via dashboard header button...");
                fetchEntries()
                    .then(() => {
                        showUserAlert("Data synced successfully!", "success");
                        populateFilterDropdowns();
                    })
                    .catch(error => {
                        console.error("Error during header sync:", error);
                    })
                    .finally(() => {
                        if (svgIcon) {
                            svgIcon.classList.remove('rotate-animate');
                        }
                        dashboardSyncButton.disabled = false;
                    });
            });
        }


         // Highlight active navigation link
  const currentPath = window.location.pathname.split("/").pop(); // e.g., "Billing.html"
  const navLinks = document.querySelectorAll("#mainNav .nav-link");

  navLinks.forEach(link => {
    if (link.getAttribute("href") === currentPath) {
      link.classList.add("text-indigo-600", "font-semibold");
    } else {
      link.classList.remove("text-indigo-600", "font-semibold");
    }
  });

    </script>
</body>
</html>